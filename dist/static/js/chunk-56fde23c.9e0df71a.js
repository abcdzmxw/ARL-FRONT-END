(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-56fde23c"],{4864:function(e,t,n){},c430b:function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"app-container calendar-list-container"},[n("basic-container",[n("avue-crud",{ref:"crud",attrs:{option:e.tableOption,page:e.page,data:e.list,search:e.search,"table-loading":e.listLoading,"before-open":e.beforeOpen,permission:e.permissionList},on:{"update:page":function(t){e.page=t},"update:search":function(t){e.search=t},"on-load":e.getPage,"selection-change":e.selectionChange,"search-change":e.searchChange,"refresh-change":e.refreshChange,"row-save":e.handleSave,"row-del":e.handleDelete},scopedSlots:e._u([{key:"statistic",fn:function(t){var a=t.row;return[a.statistic?n("div",[n("span",[e._v("站点："+e._s(a.statistic.site_cnt))]),n("br"),n("span",[e._v("域名："+e._s(a.statistic.domain_cnt))])]):n("div",[e._v("-")])]}},{key:"options",fn:function(t){t.row;return[e._v(" options ")]}},{key:"name",fn:function(t){var a=t.row;return[n("a",{staticClass:"aa",attrs:{href:"###"+a.target},on:{click:function(t){return e.linkTo(a)}}},[e._v(e._s(a.name))])]}},{key:"functionForm",fn:function(t){return[n("div",[n("el-checkbox",{attrs:{indeterminate:e.isIndeterminate},on:{change:e.handleCheckAllFunctionChange},model:{value:e.checkAllFunctions,callback:function(t){e.checkAllFunctions=t},expression:"checkAllFunctions"}},[e._v("全选")])],1),n("el-checkbox-group",{staticStyle:{"margin-top":"10px",width:"460px"},on:{change:e.handleCheckedFunctionChange},model:{value:e.checkedFuction,callback:function(t){e.checkedFuction=t},expression:"checkedFuction"}},e._l(e.functionOptions,(function(t){return n("el-checkbox",{key:t.key,attrs:{label:t.key}},[e._v(e._s(t.value))])})),1)]}},{key:"status",fn:function(t){var a=t.row;return["done"==a.status?n("el-tag",{attrs:{size:"mini",type:"success"}},[e._v(e._s(a.status))]):"error"==a.status?n("el-tag",{attrs:{size:"mini",type:"info"}},[e._v(e._s(a.status))]):n("el-tag",{attrs:{size:"mini"}},[e._v(e._s(a.status))])]}},{key:"menu",fn:function(t){var a=t.row;return[n("el-button",{attrs:{size:"small",type:"text",icon:"el-icon-refresh"},on:{click:function(t){return e.showDialog("sync",a)}}},[e._v("同步")]),n("el-button",{attrs:{size:"small",type:"text",icon:"el-icon-download"},on:{click:function(t){return e.handleExport(a)}}},[e._v("导出")]),n("el-button",{attrs:{size:"small",type:"text",icon:"el-icon-turn-off"},on:{click:function(t){return e.handleStop(a)}}},[e._v("停止")]),n("el-button",{attrs:{size:"small",type:"text",icon:"el-icon-open"},on:{click:function(t){return e.handleRestart(a)}}},[e._v("重启")])]}}]),model:{value:e.form,callback:function(t){e.form=t},expression:"form"}},[n("template",{slot:"menuLeft"},[n("el-button",{attrs:{size:"mini",icon:"el-icon-mouse",type:"primary"},on:{click:function(t){return e.showDialog("fofa")}}},[e._v("FOFA任务下发")]),n("el-button",{attrs:{size:"small",icon:"el-icon-delete",disabled:!e.selectedRows.length},on:{click:e.handleDelete}},[e._v("批量删除")]),n("el-button",{attrs:{size:"small",icon:"el-icon-delete",disabled:!e.selectedRows.length},on:{click:e.handleStop}},[e._v("批量停止")]),n("el-select",{staticStyle:{width:"140px !important"},attrs:{disabled:!e.selectedRows.length,clearable:"",size:"small",placeholder:"批量导出"},on:{change:e.handleExport},model:{value:e.exportValue,callback:function(t){e.exportValue=t},expression:"exportValue"}},e._l(e.exportOptions,(function(e){return n("el-option",{key:e.value,attrs:{label:e.label,value:e.value,disabled:e.disabled}})})),1)],1)],2),n("el-dialog",{staticClass:"avue-dialog avue-dialog--top",attrs:{size:"small",title:e.mDialog.title,visible:e.mDialog.visible,width:e.mDialog.width,top:"0","close-on-click-modal":!1,destroyOnClose:""},on:{"update:visible":function(t){return e.$set(e.mDialog,"visible",t)},opened:e.beforeOpen2}},[n("div",["sync"==e.mDialog.sign?[n("avue-form",{ref:"sync",attrs:{option:e.syncOption},model:{value:e.syncForm,callback:function(t){e.syncForm=t},expression:"syncForm"}})]:e._e(),"fofa"==e.mDialog.sign?[n("avue-form",{ref:"fofa",attrs:{option:e.fofaOption},model:{value:e.fofaForm,callback:function(t){e.fofaForm=t},expression:"fofaForm"}},[n("template",{slot:"query"},[n("el-input",{model:{value:e.fofaForm.query,callback:function(t){e.$set(e.fofaForm,"query",t)},expression:"fofaForm.query"}},[n("el-button",{attrs:{slot:"append"},on:{click:e.handleQueryTest},slot:"append"},[e._v("测试")])],1),n("div",[e._v("结果数："+e._s(e.testCount))])],1)],2)]:e._e()],2),e.mDialog.hasFoot?n("div",{staticClass:"avue-dialog__footer"},[n("el-button",{attrs:{size:"small"},on:{click:function(t){e.mDialog.visible=!1}}},[e._v("取 消")]),n("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.handleDialogSubmit}},[e._v("确 定")])],1):e._e()])],1)],1)},i=[],o=n("c7eb"),s=n("1da1"),c=(n("d3b7"),n("d81d"),n("3ca3"),n("ddb0"),n("2b3d"),n("9861"),n("b0c0"),n("159b"),n("caad"),n("2532"),n("e9c4"),n("b775"));function r(e){return Object(c["a"])({url:"/task/",method:"GET",params:e})}function l(e){return Object(c["a"])({url:"/task/",method:"post",data:e})}function u(e){return Object(c["a"])({url:"/task/delete/",method:"post",data:e})}function d(e){return Object(c["a"])({url:"/task/batch_stop/",method:"post",data:e})}function p(e){return Object(c["a"])({url:"/task/stop/".concat(e),method:"get"})}function h(e){return Object(c["a"])({url:"/task/restart/",method:"post",data:e})}function f(e){return Object(c["a"])({url:"/task/sync/",method:"post",data:e})}function m(e){return Object(c["a"])({url:"/task_fofa/submit",method:"post",data:e})}function g(e){return Object(c["a"])({url:"/task_fofa/test",method:"post",data:e})}function b(){return Object(c["a"])({url:"/task/get_domain_brute_type",method:"get"})}function y(){return Object(c["a"])({url:"/task/get_function",method:"get"})}function _(){return Object(c["a"])({url:"/task/get_port_scan_type",method:"get"})}function v(e,t){return Object(c["a"])({url:"/batch_export/".concat(e,"/"),method:"get",data:t,isNoCodeResponse:!0,responseType:"blob"})}var k={dialogDrag:!1,dialogWidth:540,labelWidth:76,border:!0,index:!0,indexLabel:"序号",stripe:!0,menuAlign:"center",menuWidth:290,menu:!0,align:"center",viewBtn:!1,excelBtn:!1,addBtn:!0,addBtnText:"添加任务",delBtn:!0,editBtn:!1,columnBtn:!1,printBtn:!1,menuType:"text",searchMenuSpan:6,searchShow:!0,searchIndex:3,searchIcon:!0,selection:!0,size:"mini",column:[{label:"任务名",prop:"name",search:!0,span:24,width:130,rules:[{required:!0,message:"请填写任务名",trigger:"blur"}]},{label:"目标",prop:"target",search:!0,type:"textarea",maxRows:2,minRows:2,span:24,width:120,searchPlaceholder:"目标",placeholder:"请输入目标，支持IP、IP段、域名",rules:[{required:!0,message:"请填写目标",trigger:"blur"}]},{label:"统计",prop:"statistic",span:12,display:!1},{label:"配置项",prop:"options",span:12,display:!1},{label:"任务类型",prop:"task_tag",search:!0,searchType:"select",dicData:[{label:"资产侦查任务",value:"task"},{label:"资产监控任务",value:"monitor"},{label:"风险巡航任务",value:"risk_cruising"},{label:"资产站点更新",value:"asset_site_update"}],span:12,hide:!0,display:!1},{label:"状态",prop:"status",search:!0,span:12,display:!1},{label:"开始时间",prop:"start_time",span:12,display:!1},{label:"结束时间",prop:"end_time",span:12,display:!1},{label:"Task_Id",prop:"_id",search:!0,span:12,width:180,display:!1},{label:"域名爆破类型",prop:"domain_brute_type",type:"select",labelWidth:140,dicData:[],props:{label:"value",value:"key"},span:24,hide:!0,rules:[{required:!0,message:"请选择",trigger:"blur"}]},{label:"端口扫描类型",prop:"port_scan_type",type:"select",labelWidth:140,dicData:[],props:{label:"value",value:"key"},span:24,hide:!0,rules:[{required:!0,message:"请选择",trigger:"blur"}]},{label:"",labelWidth:20,prop:"function",slot:!0,hide:!0}]},w=n("fc1e"),O={data:function(){return{mixScopeData:[]}},created:function(){this.getMixScopeData()},methods:{getMixScopeData:function(){var e=this;Object(w["c"])({}).then((function(t){e.mixScopeData=t.items}))}}},x={data:function(){return{mixPolicyData:[]}},created:function(){this.getMixPolicyData()},methods:{getMixPolicyData:function(){var e=this;Object(w["k"])({}).then((function(t){e.mixPolicyData=t.items}))}}},D={name:"MenuList",components:{},mixins:[O,x],data:function(){return{search:{},tableOption:k,page:{total:0,currentPage:1,pageSize:10,ascs:[],descs:[]},paramsSearch:{},list:[],listLoading:!1,form:{},selectedRows:[],exportOptions:[{label:"C段批量导出",value:"cip"},{label:"域名批量导出",value:"domain"},{label:"IP批量导出",value:"ip"},{label:"IP端口批量导出",value:"ip_port"},{label:"站点批量导出",value:"site"},{label:"URL批量导出",value:"url"}],checkAllFunctions:!1,isIndeterminate:!1,exportValue:"",checkedFuction:[],functionOptions:[],domainBruteOptions:[],portScanOptions:[],mDialog:{title:"提示",visible:!1,width:"40%",hasFoot:!0,sign:""},syncOption:{labelWidth:120,menuBtn:!1,column:[{label:"资产信息",type:"select",prop:"scope_id",span:23,props:{label:"name",value:"_id"},dicData:[],rules:[{required:!0,message:"请选择",trigger:"blur"}]}]},syncForm:{},curr_task_id:"",fofaForm:{},fofaOption:{labelWidth:120,menuBtn:!1,column:[{label:"任务名称",prop:"name",span:23,rules:[{required:!0,message:"请填写",trigger:"blur"}]},{label:"查询语句",prop:"query",span:23,rules:[{required:!0,message:"请填写",trigger:"blur"}]},{label:"关联策略",type:"select",prop:"policy_id",span:23,props:{},dicData:[],rules:[{required:!1,message:"请选择",trigger:"blur"}]}]},testCount:0}},computed:{permissionList:function(){return{}}},watch:{},created:function(){},methods:{selectionChange:function(e){this.selectedRows=e},getPage:function(e,t){var n=this;this.listLoading=!0,r(Object.assign({page:e.currentPage,size:e.pageSize,descs:this.page.descs,ascs:this.page.ascs},t)).then((function(e){200==e.code&&(n.list=e.items,n.page.total=e.total,n.page.currentPage=e.page,n.page.pageSize=e.size)})).catch((function(e){})).finally((function(){n.listLoading=!1}))},refreshChange:function(e){this.getPage(this.page)},searchChange:function(e,t){this.page.currentPage=1,this.getPage(this.page,this.filterForm(e)),t()},beforeOpen:function(e,t){var n=this;return Object(s["a"])(Object(o["a"])().mark((function t(){var a,i,s,c;return Object(o["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=n.tableOption.column,t.next=3,b();case 3:return i=t.sent,t.next=6,_();case 6:return s=t.sent,t.next=9,y();case 9:c=t.sent,a[9].dicData=i.data,a[10].dicData=s.data,n.functionOptions=c.data,e();case 14:case"end":return t.stop()}}),t)})))()},handleRestart:function(e){var t=this;this.$confirm("是否重启选择的记录","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var n={task_id:[e._id]};h(n).then((function(e){200==e.code?(t.$message({showClose:!0,message:e.message,type:"success"}),t.getPage(t.page)):t.$message({showClose:!0,message:e.message,type:"error"})}))}))},handleStop:function(e){var t=this;this.$confirm("是否确认停止选择的记录","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var n=e._id?e._id:{task_id:t.selectedRows.map((function(e){return e._id}))},a=e._id?p:d;a(n).then((function(e){200==e.code?(t.$message({showClose:!0,message:e.message,type:"success"}),t.getPage(t.page)):t.$message({showClose:!0,message:e.message,type:"error"})}))}))},handleDelete:function(e){var t=this;this.$confirm("是否确认删除选择的记录","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var n={task_id:e._id?[e._id]:t.selectedRows.map((function(e){return e._id}))};u(n).then((function(e){200==e.code?(t.$message({showClose:!0,message:e.message,type:"success"}),t.getPage(t.page)):t.$message({showClose:!0,message:e.message,type:"error"})}))}))},handleExport:function(e){var t=this;this.$confirm("是否导出?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var n=e._id?"":t.exportValue,a={task_id:e._id?[e._id]:t.selectedRows.map((function(e){return e._id}))};v(n,a).then((function(e){if(window.navigator.msSaveBlob)try{var t=new Blob([e.data]);window.navigator.msSaveBlob(t,"导出文件.txt")}catch(i){}else{var n=window.URL.createObjectURL(e.data),a=document.createElement("a");a.style.display="none",a.href=n,a.setAttribute("download","导出文件.txt"),document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(a.href)}})).catch((function(e){})).finally((function(){t.listLoading=!1}))}))},handleSave:function(e,t,n){var a=this,i=this,o=e.name,s=e.target,c=e.domain_brute_type,r=e.port_scan_type,u={name:o,target:s,domain_brute_type:c,port_scan_type:r},d={};i.functionOptions.forEach((function(e){d[e.key]=i.checkedFuction.includes(e.key)}));var p=Object.assign(u,d);l(p).then((function(e){200==e.code?(i.$message({showClose:!0,message:e.message,type:"success"}),i.getPage(a.page)):(i.$message({showClose:!0,message:e.message,type:"error"}),i.getPage(a.page))})).catch((function(e){})).finally((function(){t(),n()}))},beforeOpen2:function(){},showDialog:function(e,t){this.mDialog.sign=e,this.mDialog.visible=!0,"sync"==e&&(this.mDialog.title="同步",this.mDialog.width="480px",this.curr_task_id=t._id,this.syncOption.column[0].dicData=this.mixScopeData),"fofa"==e&&(this.mDialog.title="FOFA任务下发",this.mDialog.width="680px",this.fofaOption.column[2].dicData=this.mixPolicyData)},handleDialogSubmit:function(e){var t=this,n={},a=null;"sync"==this.mDialog.sign&&this.$refs.sync.validate((function(e){e&&(n={task_id:t.curr_task_id,scope_id:t.syncForm.scope_id},a=f)})),"fofa"==this.mDialog.sign&&this.$refs.fofa.validate((function(e){e&&(n={query:t.fofaForm.query,name:t.fofaForm.name,policy_id:t.fofaForm.policy_id},a=m)})),a&&a(n).then((function(e){t.$message({showClose:!0,message:e.message,type:"success"}),t.closeDialog()})).catch((function(e){t.$message({showClose:!0,message:res.message,type:"error"})})).finally((function(){e(),t.closeDialog()}))},closeDialog:function(){this.mDialog.visible=!1},handleQueryTest:function(){var e=this;if(this.fofaForm.query){var t={query:this.fofaForm.query};g(t).then((function(t){e.$message({showClose:!0,message:t.message,type:"success"})}))}},linkTo:function(e){var t=this.$router.resolve({path:"/task/detail",query:{task_id:e._id,targetName:e.target,statistic:JSON.stringify(e.statistic)}});window.open(t.href,"_blank")},handleCheckedFunctionChange:function(e){this.isIndeterminate=e.length>0&&e.length<this.functionOptions.length,this.checkAllFunctions=e.length===this.functionOptions.length},handleCheckAllFunctionChange:function(e){this.checkedFuction=e?this.functionOptions.map((function(e){return e.key})):[],this.isIndeterminate=!1}}},F=D,j=(n("d2ed"),n("2877")),C=Object(j["a"])(F,a,i,!1,null,"70984210",null);t["default"]=C.exports},d2ed:function(e,t,n){"use strict";n("4864")},fc1e:function(e,t,n){"use strict";n.d(t,"k",(function(){return i})),n.d(t,"j",(function(){return o})),n.d(t,"a",(function(){return s})),n.d(t,"l",(function(){return c})),n.d(t,"b",(function(){return r})),n.d(t,"i",(function(){return l})),n.d(t,"d",(function(){return u})),n.d(t,"e",(function(){return d})),n.d(t,"f",(function(){return p})),n.d(t,"g",(function(){return h})),n.d(t,"h",(function(){return f})),n.d(t,"c",(function(){return m}));var a=n("b775");function i(e){return Object(a["a"])({url:"/policy/",method:"GET",params:e})}function o(e){return Object(a["a"])({url:"/policy/?_id=".concat(e),method:"GET"})}function s(e){return Object(a["a"])({url:"/policy/add/",method:"POST",data:e})}function c(e){return Object(a["a"])({url:"/policy/edit/",method:"POST",data:e})}function r(e){return Object(a["a"])({url:"/policy/delete/",method:"POST",data:e})}function l(e){return Object(a["a"])({url:"/task/policy/",method:"POST",data:e})}function u(){return Object(a["a"])({url:"/policy/get_domain_function",method:"GET"})}function d(){return Object(a["a"])({url:"/policy/get_poc_config",method:"GET"})}function p(){return Object(a["a"])({url:"/policy/get_port_scan_type",method:"GET"})}function h(){return Object(a["a"])({url:"/policy/get_site_vuln",method:"GET"})}function f(){return Object(a["a"])({url:"/policy/get_weak_password",method:"GET"})}function m(e){return Object(a["a"])({url:"/asset_scope/",method:"GET",params:e})}}}]);